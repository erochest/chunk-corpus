!function(n){"use strict";zip.workerScriptsPath="/scripts/";var t=/[\w'-–—]*\w/g,e=function(n,t,e){for(var r=[n],a=n.length;t>a;)r.push(e),a+=e.length;return r.reverse().join("")},r=function(n,t){var r=/^(.+)\.[^.]*$/,a=n.replace(r,"$1"),o=e(t.toString(),6,"0");return a+"-"+o+".txt"},a=function(n){return n.name=r(n.name,n.contents.start),n},o=function(n){return n.match(t)},u=function(n,t,e){var r=[],a=0;if(n.length<t)r.push(n);else for(;a<=n.length;)r.push({start:a,data:n.slice(a,a+t)}),a+=e;return r},i=function(n){return Bacon.fromCallback(function(t){var e=new FileReader;e.onload=function(e){t({name:n.name,contents:e.target.result})},e.readAsText(n)})},l=function(t,e,r,a){if(r<e.length){var o=e[r];t.add(o.name,new zip.TextReader(o.contents),function(){var o=n("#chunk_progress");l(t,e,r+1,a),o.attr("value",1+parseInt(o.attr("value")))})}else a(t)},c=function(n){return Bacon.fromCallback(function(t){zip.createWriter(new zip.BlobWriter,function(e){l(e,n,0,t)})})},f=function(n){return Bacon.fromCallback(function(t){n.close(t)})},s=function(n){saveAs(n,"corpus-chunks.zip")},p=function(n,t){return function(e){return e[n]=t(e[n]),e}},g=function(n){return function(t){for(var e=t[n].slice(),r=Object.getOwnPropertyNames(t),a=0;a<e.length;a++){for(var o={},u=0;u<r.length;u++){var i=r[u];o[i]=t[i]}o[n]=e[a],e[a]=o}return Bacon.fromArray(e)}},m=function(t,e,r){return Bacon.sequentially(0,r).filter(function(n){return"text/plain"===n.type}).flatMap(i).map(p("contents",o)).map(p("contents",function(r){var a=u(r,t,e),o=n("#chunk_progress");return o.attr("max",a.length+parseInt(o.attr("max"))-1),a})).flatMap(g("contents")).map(a).map(p("contents",function(n){return n.data.join(" ")})).fold([],function(n,t){return n.push(t),n}).filter(function(n){return n.length>0}).flatMap(c).flatMap(f)},v=function(n){return n.asEventStream("change").map(function(n){return parseInt(n.target.value)}).filter(function(n){return!isNaN(n)}).toProperty(n.val())};n(function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t=n("#input_files"),e=n("#drop_target"),r=null,a=null,o=null,u=null,i=null,l=null,c=null;a=v(n("#chunk_size")),o=v(n("#chunk_step")),r=e.asEventStream("done").map(function(){return[]}),u=t.asEventStream("change"),l=u.flatMap(function(n){return n.target.files}),e.on("dragover",function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"}),i=e.asEventStream("drop").doAction(function(n){n.stopPropagation(),n.preventDefault()}),c=i.flatMap(function(n){return n.originalEvent.dataTransfer.files});var f=Bacon.mergeAll(l,c,r).map(function(t){return n("#progress_modal").openModal(),n("#chunk_progress").attr("max",t.length).attr("value",0),t});Bacon.combineWith(m,a,o,f).flatMap(function(n){return n}).onValue(function(t){s(t),n("#progress_modal").closeModal(),e.trigger(n.Event("done"))})}else n("#error_modal").openModal()})}(jQuery);