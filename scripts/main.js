!function(n){"use strict";zip.workerScriptsPath="/scripts/";var t=/[\w'-–—]*\w/g,e=function(n,t,e){for(var r=[n],a=n.length;t>a;)r.push(e),a+=e.length;return r.reverse().join("")},r=function(n,t){var r=/^(.+)\.[^.]*$/,a=n.replace(r,"$1"),o=e(t.toString(),6,"0");return a+"-"+o+".txt"},a=function(n){return n.name=r(n.name,n.contents.start),n},o=function(n){return n.match(t)},i=function(n,t,e){var r=[],a=0;if(n.length<t)r.push(n);else for(;a<=n.length;)r.push({start:a,data:n.slice(a,a+t)}),a+=e;return r},u=function(n){return Bacon.fromCallback(function(t){var e=new FileReader;e.onload=function(e){t({name:n.name,contents:e.target.result})},e.readAsText(n)})},c=function(n,t,e,r){if(e<t.length){var a=t[e];n.add(a.name,new zip.TextReader(a.contents),function(){c(n,t,e+1,r)})}else r(n)},l=function(n){return Bacon.fromCallback(function(t){zip.createWriter(new zip.BlobWriter,function(e){c(e,n,0,t)})})},f=function(n){return Bacon.fromCallback(function(t){n.close(t)})},s=function(n){saveAs(n,"corpus-chunks.zip")},p=function(n,t){return function(e){return e[n]=t(e[n]),e}},d=function(n){return function(t){for(var e=t[n].slice(),r=Object.getOwnPropertyNames(t),a=0;a<e.length;a++){for(var o={},i=0;i<r.length;i++){var u=r[i];o[u]=t[u]}o[n]=e[a],e[a]=o}return Bacon.fromArray(e)}},g=function(n,t){return function(e){return Bacon.sequentially(0,e).filter(function(n){return"text/plain"===n.type}).flatMap(u).map(p("contents",o)).map(p("contents",function(e){return i(e,n,t)})).flatMap(d("contents")).map(a).map(p("contents",function(n){return n.data.join(" ")})).fold([],function(n,t){return n.push(t),n}).filter(function(n){return n.length>0}).flatMap(l).flatMap(f)}};n(function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t=n("#input_files"),e=n("#drop_target"),r=parseInt(n("#chunk_size").val()),a=parseInt(n("#chunk_step").val()),o=null,i=null,u=null,c=null;o=t.asEventStream("change"),u=o.flatMap(function(n){return n.target.files}),e.on("dragover",function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"}),i=e.asEventStream("drop").doAction(function(n){n.stopPropagation(),n.preventDefault()}),c=i.flatMap(function(n){return n.originalEvent.dataTransfer.files}),Bacon.mergeAll(u,c).flatMap(g(r,a)).onValue(s)}else n("#error_modal").openModal()})}(jQuery);