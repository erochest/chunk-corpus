!function(n){"use strict";zip.workerScriptsPath="/scripts/";var t=/[\w'-–—]*\w/g,e=function(n,t,e){for(var r=[n],a=n.length;t>a;)r.push(e),a+=e.length;return r.reverse().join("")},r=function(n,t){var r=/^(.+)\.[^.]*$/,a=n.replace(r,"$1"),o=e(t.toString(),6,"0");return a+"-"+o+".txt"},a=function(n){return n.name=r(n.name,n.contents.start),n},o=function(n){return n.match(t)},l=function(n,t,e){var r=[],a=0;if(n.length<t)r.push(n);else for(;a<=n.length;)r.push({start:a,data:n.slice(a,a+t)}),a+=e;return r},u=function(n){return Bacon.fromCallback(function(t){var e=new FileReader;e.onload=function(e){t({name:n.name,contents:e.target.result})},e.readAsText(n)})},i=function(t,e,r,a){if(r<e.length){var o=e[r];t.add(o.name,new zip.TextReader(o.contents),function(){var o=n("#chunk_progress");i(t,e,r+1,a),o.attr("value",1+parseInt(o.attr("value")))})}else a(t)},c=function(n){return Bacon.fromCallback(function(t){zip.createWriter(new zip.BlobWriter,function(e){i(e,n,0,t)})})},f=function(n){return Bacon.fromCallback(function(t){n.close(t)})},s=function(n){saveAs(n,"corpus-chunks.zip")},p=function(n,t){return function(e){return e[n]=t(e[n]),e}},g=function(n){return function(t){for(var e=t[n].slice(),r=Object.getOwnPropertyNames(t),a=0;a<e.length;a++){for(var o={},l=0;l<r.length;l++){var u=r[l];o[u]=t[u]}o[n]=e[a],e[a]=o}return Bacon.fromArray(e)}},d=function(t,e){return function(r){return Bacon.sequentially(0,r).log("sequentially").filter(function(n){return"text/plain"===n.type}).log("filter (text/plain)").flatMap(u).log("readTextFile").map(p("contents",o)).log("tokenize").map(p("contents",function(r){var a=l(r,t,e),o=n("#chunk_progress");return o.attr("max",a.length+parseInt(o.attr("max"))-1),a})).log("chunk").flatMap(g("contents")).log("spread").map(a).log("updateOutputFileName").map(p("contents",function(n){return n.data.join(" ")})).log("join").fold([],function(n,t){return n.push(t),n}).log("fold").filter(function(n){return n.length>0}).log("filter (empty)").flatMap(c).log("zipAll").flatMap(f)}};n(function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t=n("#input_files"),e=n("#drop_target"),r=parseInt(n("#chunk_size").val()),a=parseInt(n("#chunk_step").val()),o=null,l=null,u=null,i=null;o=t.asEventStream("change"),u=o.flatMap(function(n){return n.target.files}),e.on("dragover",function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"}),l=e.asEventStream("drop").doAction(function(n){n.stopPropagation(),n.preventDefault()}),i=l.flatMap(function(n){return n.originalEvent.dataTransfer.files}),Bacon.mergeAll(u,i).log("mergeAll").map(function(t){return n("#progress_modal").openModal(),n("#chunk_progress").attr("max",t.length).attr("value",0),t}).log("progress_modal.openModal").flatMap(d(r,a)).log("zipChunks").onValue(function(t){s(t),n("#progress_modal").closeModal()})}else n("#error_modal").openModal()})}(jQuery);